primary_timepoint == "1",
is.na(post_crossover) | !Detect(post_crossover, "1"),
outcome_type == "msd" | outcome_type == "imsd",
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "10 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "10 mg")),
!Detect(study, "Krempien 2023"),
!Detect(study, "Carhart-Harris 2021")
)
main_results <- runMetaAnalysis(data_main,
# Specify models to run
which.run = c("overall", "outliers"),
which.influence = "overall",
which.outliers = "overall",
# Specify statistical parameters
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
summary(main_results$model.overall)
# Create simple forest plot of results
meta::forest(
main_results$model.overall,
sortvar = main_results$model.overall$data$year,
layout = "JAMA"
)
meta::forest(main_results$model.overall,
sortvar = main_results$model.overall$data$year,
leftcols = c("studlab", "n_arm1", "mean_arm1", "sd_arm1", "n_arm2", "mean_arm2", "sd_arm2"),
leftlabs = c("Study", "N", "Mean", "SD", "N", "Mean", "SD"),
fontsize = 9,
col.square = "#000080",
col.diamond = "#000080",
col.predict = "gray",
fontfamily = "Arial",
colgap.forest = "2cm",
xlim = c(-4.5, 1.5),
label.left = "Favors intervention",
label.right = "Favors control",
smlab = "SMD")
dev.off()
main_forest_plot <- meta::forest(main_results$model.overall,
sortvar = main_results$model.overall$data$year,
leftcols = c("studlab", "n_arm1", "mean_arm1", "sd_arm1", "n_arm2", "mean_arm2", "sd_arm2"),
leftlabs = c("Study", "N", "Mean", "SD", "N", "Mean", "SD"),
fontsize = 9,
col.square = "#000080",
col.diamond = "#000080",
col.predict = "gray",
fontfamily = "Arial",
colgap.forest = "2cm",
xlim = c(-4.5, 1.5),
label.left = "Favors intervention",
label.right = "Favors control",
smlab = "SMD")
ggsave(file.path(basedir, "analysis/psilodep/paperfigs/Fig_02.png"),
plot = main_forest_plot, width = 10, height = 8, dpi = 300
)
png(filename = basedir,"analysis/psilodep/paperfigs/Fig_02.png", res=315, width=4500, height=1500)
png(filename = file.path(basedir,"analysis/psilodep/paperfigs/Fig_02.png"), res=315, width=4500, height=1500)
meta::forest(main_results$model.overall,
sortvar = main_results$model.overall$data$year,
leftcols = c("studlab", "n_arm1", "mean_arm1", "sd_arm1", "n_arm2", "mean_arm2", "sd_arm2"),
leftlabs = c("Study", "N", "Mean", "SD", "N", "Mean", "SD"),
fontsize = 9,
col.square = "#000080",
col.diamond = "#000080",
col.predict = "gray",
fontfamily = "Arial",
colgap.forest = "2cm",
xlim = c(-4.5, 1.5),
label.left = "Favors intervention",
label.right = "Favors control",
smlab = "SMD")
dev.off()
png(filename = file.path(basedir,"analysis/psilodep/paperfigs/continuous_forest_plot_meta.png"), res=315, width=4500, height=1500)
meta::forest(main_results$model.overall,
sortvar = main_results$model.overall$data$year,
leftcols = c("studlab", "n_arm1", "mean_arm1", "sd_arm1", "n_arm2", "mean_arm2", "sd_arm2"),
leftlabs = c("Study", "N", "Mean", "SD", "N", "Mean", "SD"),
fontsize = 9,
col.square = "#000080",
col.diamond = "#000080",
col.predict = "gray",
fontfamily = "Arial",
colgap.forest = "2cm",
xlim = c(-4.5, 1.5),
label.left = "Favors intervention",
label.right = "Favors control",
smlab = "SMD")
dev.off()
#basedir <- "/Users/sps253/Documents/GIT/sypres-docs/"
basedir <- "/Users/bsevchik/Documents/GitHub/sypres-docs" #for brooke
knitr::opts_knit$set(
base.dir = basedir,
base.url = "/"
)
knitr::opts_chunk$set(fig.path = "analysis/psilodep/knitfigs/")
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(meta)
library(metafor)
library(esc)
library(metapsyTools)
library(dmetar)
library(gt)
# Load data
#data <- read_csv("/Users/sps253/Documents/GIT/data-depression-psiloctr/data.csv")
data <- read_csv("/Users/bsevchik/Documents/GitHub/metapsy_psilodep/data.csv")
# after release we will replace this with metapsyData load function
# Check data format with checkDataFormat
checkDataFormat(data)
# Check conflicts with checkConflicts
checkConflicts(data)
data_main <- data %>%
filterPoolingData(
primary_instrument == "1",
primary_timepoint == "1",
is.na(post_crossover) | !Detect(post_crossover, "1"),
outcome_type == "msd" | outcome_type == "imsd",
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "10 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "10 mg")),
!Detect(study, "Krempien 2023"),
!Detect(study, "Carhart-Harris 2021")
)
main_results <- runMetaAnalysis(data_main,
# Specify models to run
which.run = c("overall", "outliers"),
which.influence = "overall",
which.outliers = "overall",
# Specify statistical parameters
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
summary(main_results$model.overall)
# Create simple forest plot of results
meta::forest(
main_results$model.overall,
sortvar = main_results$model.overall$data$year,
layout = "JAMA"
)
# Build a dataframe for each subgroup and sensitivity analysis
data_dep <- data_main %>%
filterPoolingData(
diagnosis == "dep" | diagnosis == "trd"
)
data_excwl <- data_main %>%
filterPoolingData(
!Detect(condition_arm2, "wl"),
)
data_rob <- data_main %>%
filterPoolingData(
!Detect(rob, "High"),
)
data_parallel <- data_main %>%
filterPoolingData(
design == "parallel"
)
data_crossover <- data_main %>%
filterPoolingData(
design == "crossover"
)
data_expanded <- data %>%
filterPoolingData(
primary_instrument == "1",
primary_timepoint == "1",
outcome_type == "msd" | outcome_type == "imsd",
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "10 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "10 mg")),
!(Detect(study, "Krempien 2023") & (!is.na(multi_arm1)) & Detect(multi_arm1, "12 mg")),
!(Detect(study, "Krempien 2023") & (!is.na(multi_arm2)) & Detect(multi_arm2, "12 mg"))
)
data_outliers <- data_main %>%
filterPoolingData(
!Detect(study, "Davis 2021")
)
data_fixed <- data_main
data_g10 <- data %>%
filterPoolingData(
primary_instrument == "1",
primary_timepoint == "1",
is.na(post_crossover) | !Detect(post_crossover, "1"),
outcome_type == "msd" | outcome_type == "imsd",
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "25 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "25 mg")),
!Detect(study, "Krempien 2023"),
!Detect(study, "Carhart-Harris 2021")
)
data_clinician <- data %>%
filterPoolingData(
primary_timepoint == "1",
is.na(post_crossover) | !Detect(post_crossover, "1"),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "10 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "10 mg")),
!Detect(study, "Krempien 2023"),
!Detect(study, "Carhart-Harris 2021"),
rating == "clinician",
Detect(instrument_symptom, "depression"),
outcome_type != "response",
outcome_type != "remission",
outcome_type != "change"
) %>%
filterPriorityRule(instrument = c("madrs", "grid-ham-d"))
data_selfreport <- data %>%
filterPoolingData(
primary_timepoint == "1",
is.na(post_crossover) | !Detect(post_crossover, "1"),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm1)) & Detect(multi_arm1, "10 mg")),
!(Detect(study, "Goodwin 2022") & (!is.na(multi_arm2)) & Detect(multi_arm2, "10 mg")),
!Detect(study, "Krempien 2023"),
!Detect(study, "Carhart-Harris 2021"),
rating == "self-report",
Detect(instrument_symptom, "depression"),
outcome_type != "response",
outcome_type != "remission",
outcome_type != "change" & outcome_type != "unknown"
) %>%
filterPriorityRule(instrument = c("bdi", "qids-sr", "hads-d", "smdds", "hads"))
# Run the main "overall" model for comparison
main <- runMetaAnalysis(data_main,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
# Use metapsyTools' replacement and rerun functions for quickly changing parameters
dep <- main # copy the main model
data(dep) <- data_dep # replace the dataframe in the new model
rerun(dep) # re-run the model
excwl <- main
data(excwl) <- data_excwl
rerun(excwl)
rob <- main
data(rob) <- data_rob
rerun(rob)
parallel <- main
data(parallel) <- data_parallel
rerun(parallel)
crossover <- main
data(crossover) <- data_crossover
rerun(crossover)
expanded <- main
data(expanded) <- data_expanded
rerun(expanded)
outliers <- main
data(outliers) <- data_outliers
rerun(outliers)
fixed <- main
method.tau(fixed) <- "FE" # for this sensitivity analysis, we keep data the same but change parameters
hakn(fixed) <- FALSE
rerun(fixed)
g10 <- main
data(g10) <- data_g10
rerun(g10)
clinician <- main
data(clinician) <- data_clinician
rerun(clinician)
selfreport <- main
data(selfreport) <- data_selfreport
rerun(selfreport)
main <- runMetaAnalysis(data_main,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
dep <- runMetaAnalysis(data_dep,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
excwl <- runMetaAnalysis(data_excwl,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
rob <- runMetaAnalysis(data_rob,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
parallel <- runMetaAnalysis(data_parallel,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
crossover <- runMetaAnalysis(data_crossover,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
expanded <- runMetaAnalysis(data_expanded,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
outliers <- runMetaAnalysis(data_outliers,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
fixed <- runMetaAnalysis(data_main,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "FE", # fixed effects
method.tau.ci = "Q-Profile",
hakn = FALSE,
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "study_time_point",
round.digits = 2
)
g10 <- runMetaAnalysis(data_g10,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
clinician <- runMetaAnalysis(data_clinician,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
selfreport <- runMetaAnalysis(data_selfreport,
# Specify statistical parameters
which.run = "overall", # inverse variance random effects
es.measure = "g", # Hedges' g
method.tau = "REML",
method.tau.ci = "Q-Profile",
hakn = TRUE, # Knapp-Hartung adjustment
# Specify variables
study.var = "study",
arm.var.1 = "condition_arm1",
arm.var.2 = "condition_arm2",
measure.var = "instrument",
w1.var = "n_arm1",
w2.var = "n_arm2",
time.var = "time_weeks",
round.digits = 2
)
png(filename = file.path(basedir,"analysis/psilodep/paperfigs/expanded_forest_plot_meta.png"), res=315, width=4500, height=1500)
meta::forest(expanded$model.overall,
sortvar = expanded$model.overall$data$year,
leftcols = c("studlab", "n_arm1", "mean_arm1", "sd_arm1", "n_arm2", "mean_arm2", "sd_arm2"),
leftlabs = c("Study", "N", "Mean", "SD", "N", "Mean", "SD"),
fontsize = 9,
col.square = "#000080",
col.diamond = "#000080",
col.predict = "gray",
fontfamily = "Arial",
colgap.forest = "2cm",
xlim = c(-4.5, 1.5),
label.left = "Favors intervention",
label.right = "Favors control",
smlab = "SMD")
dev.off()
